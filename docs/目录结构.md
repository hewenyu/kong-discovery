# 项目目录结构

本文档定义了 Kong 网关 DNS 服务发现系统的标准目录结构，旨在提高代码的可维护性、可读性和模块化。所有开发活动应遵循此结构。

## 顶层目录结构

```
kong-discovery/
├── .github/             # GitHub Actions CI/CD 工作流等
├── api/                 # API .proto 文件和生成的 Go gRPC/protobuf 代码 (如果未来使用gRPC)
├── build/               # 构建脚本和 Dockerfile
│   ├── package/         # 打包脚本 (例如 .deb, .rpm)
│   └── docker/
│       ├── app/         # Go 应用的 Dockerfile
│       └── ui/          # 前端 UI 的 Dockerfile
├── cmd/                 # 项目主程序入口
│   ├── dns-discovery/   # DNS 服务发现主程序 (包含服务注册、管理API、DNS服务)
│   │   └── main.go
│   └── client-example/  # (可选) Go SDK 使用示例
│       └── main.go
├── configs/             # 默认配置文件和示例
├── deployments/         # Kubernetes, Docker Compose 等部署配置文件
│   ├── docker-compose/
│   └── kubernetes/
├── docs/                # 项目文档 (需求、设计、API文档、本文件等)
├── internal/            # 私有应用和库代码，不希望被其他应用导入
│   ├── admin/           # 管理API模块 (HTTP handlers, services)
│   │   ├── handler/
│   │   └── service/
│   ├── core/            # 核心业务逻辑，被多个内部模块共享 (如etcd操作封装)
│   ├── dns/             # DNS服务模块 (DNS resolver logic)
│   ├── registration/    # 服务注册API模块 (HTTP handlers, services)
│   │   ├── handler/
│   │   └── service/
│   ├── store/           # 数据存储交互层 (etcd具体实现)
│   └── utils/           # 通用工具函数
├── pkg/                 # 公共库代码，可以被外部应用导入 (如Go SDK)
│   └── discovery/       # 服务发现客户端SDK (Go SDK)
├── scripts/             # 辅助脚本 (如代码生成、测试脚本)
├── test/                # 测试相关文件
│   ├── e2e/             # 端到端测试
│   └── integration/     # 集成测试
├── web/                 # 前端UI代码 (React, Vite, Tailwind)
│   ├── public/
│   ├── src/
│   │   ├── assets/
│   │   ├── components/    # React UI 组件 (可复用的小组件)
│   │   ├── features/      # 基于特性的模块 (如 服务管理、DNS配置管理等)
│   │   ├── hooks/
│   │   ├── layouts/
│   │   ├── pages/         # 页面级组件
│   │   ├── services/      # API 调用服务 (React SDK/封装)
│   │   ├── store/         # 前端状态管理 (如 Zustand, Redux)
│   │   ├── styles/
│   │   ├── types/
│   │   └── App.tsx
│   ├── index.html
│   ├── package.json
│   ├── postcss.config.js
│   ├── tailwind.config.js
│   └── tsconfig.json
├── .editorconfig
├── .gitignore
├── .golangci.yml        # Go linter 配置文件
├── go.mod
├── go.sum
├── LICENSE
└── README.md
```

## 目录说明

### `/.github/`
- 存放 GitHub 相关配置文件，主要是用于 CI/CD 的 GitHub Actions workflows。

### `/api/`
- (可选，为未来gRPC等准备) 存放 `.proto` 定义文件。
- 存放由 `.proto` 文件自动生成的Go代码。

### `/build/`
- **`/build/package/`**: 存放用于构建可分发软件包（如 `.deb`, `.rpm`）的脚本和元数据。
- **`/build/docker/`**: 存放各个服务的 `Dockerfile`。
    - **`app/`**: Go 后端应用的 Dockerfile。
    - **`ui/`**: 前端 UI 应用的 Dockerfile。

### `/cmd/`
- 项目的可执行程序入口。每个子目录对应一个可执行文件。
- **`/cmd/dns-discovery/main.go`**: DNS 服务发现系统的主程序，它将启动所有必要的服务（服务注册API、管理API、DNS服务）。
- **`/cmd/client-example/main.go`**: (可选) 一个简单的Go程序，演示如何使用 `pkg/discovery` SDK。

### `/configs/`
- 存放默认的配置文件模板或示例配置文件。方便用户了解如何配置系统。

### `/deployments/`
- 存放用于不同环境部署的配置文件。
- **`/deployments/docker-compose/`**: 用于本地开发和测试的 `docker-compose.yml` 文件。
- **`/deployments/kubernetes/`**: 用于生产环境部署的 Kubernetes manifests (Deployments, Services, ConfigMaps, etc.)。

### `/docs/`
- 包含所有项目相关的文档，例如需求文档、架构设计、API文档、本目录结构文档等。

### `/internal/`
- 项目内部的私有代码，不应该被其他外部项目导入。这是Go项目的标准实践，确保内部代码的封装性。
- **`/internal/admin/`**: 管理API (端口9090) 的具体实现，包括HTTP处理器和业务逻辑服务。
    - `handler/`: HTTP请求处理器。
    - `service/`: 业务逻辑。
- **`/internal/core/`**: 一些被多个内部模块共享的核心逻辑，例如对etcd操作的通用封装、公共的数据结构转换等。
- **`/internal/dns/`**: DNS服务 (端口53) 的核心实现逻辑，包括DNS查询解析、记录生成、上游转发等。
- **`/internal/registration/`**: 服务注册API (端口8080) 的具体实现，包括HTTP处理器和业务逻辑服务。
    - `handler/`: HTTP请求处理器。
    - `service/`: 业务逻辑。
- **`/internal/store/`**: 数据存储层，封装与etcd的直接交互逻辑，如服务信息的CRUD、命名空间管理、自定义DNS记录管理等。供其他 `internal` 包调用。
- **`/internal/utils/`**: 项目内部使用的通用工具函数，例如字符串处理、时间处理、错误处理辅助等。

### `/pkg/`
- 可以被外部应用安全导入的公共库代码。
- **`/pkg/discovery/`**: 提供给客户端使用的Go SDK，用于服务注册、注销和心跳。

### `/scripts/`
- 存放各种辅助脚本，例如代码生成、版本管理、测试环境设置等。

### `/test/`
- 存放非单元测试的测试文件。
- **`/test/e2e/`**: 端到端测试，模拟用户真实场景进行测试。
- **`/test/integration/`**: 集成测试，测试多个组件协同工作的正确性。
- 单元测试应与被测试的代码放在同一个包内，并以 `_test.go` 结尾。

### `/web/`
- 前端React应用的所有代码。
- **`/web/public/`**: 静态资源，会被直接拷贝到构建输出目录。
- **`/web/src/`**: 前端源码。
    - `assets/`: 图片、字体等静态资源。
    - `components/`: 可复用的UI组件 (按钮、输入框、卡片等)。
    - `features/`: 基于特性/功能的模块化组件和逻辑 (例如服务管理模块、DNS配置模块，每个模块可能有自己的子组件、页面、服务调用)。
    - `hooks/`: 自定义的React Hooks。
    - `layouts/`: 页面布局组件 (如通用头部、侧边栏布局)。
    - `pages/`: 顶层页面组件，通常对应一个路由。
    - `services/`: 与后端API交互的服务层 (使用React SDK或直接fetch/axios封装)。
    - `store/`: 全局状态管理 (如果使用Zustand, Redux等)。
    - `styles/`: 全局样式或Tailwind基础配置。
    - `types/`: TypeScript类型定义。
    - `App.tsx`: React应用的根组件。
- `index.html`: 应用入口HTML。
- `package.json`: 项目依赖和脚本。
- `postcss.config.js`, `tailwind.config.js`: PostCSS和Tailwind CSS配置文件。
- `tsconfig.json`: TypeScript配置文件。

### 根目录文件
- **`.editorconfig`**: 编辑器配置，确保代码风格一致性。
- **`.gitignore`**: 指定Git忽略的文件和目录。
- **`.golangci.yml`**: `golangci-lint` 的配置文件。
- **`go.mod`, `go.sum`**: Go模块管理文件。
- **`LICENSE`**: 项目许可证。
- **`README.md`**: 项目的入口说明文档。

## 注意事项
- **模块化**: 后端服务 (`admin`, `dns`, `registration`) 应尽量解耦，通过定义清晰的接口进行交互，或者通过共享的 `core` 和 `store` 模块。
- **配置分离**: 敏感信息和环境特定配置不应硬编码到代码中，应通过配置文件或环境变量注入。
- **测试**: 单元测试、集成测试和端到端测试都非常重要，应确保足够的测试覆盖率。

此目录结构提供了一个起点，可以根据项目发展和团队偏好进行适当调整。关键是保持一致性和清晰性。 