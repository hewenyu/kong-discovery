# Kong网关DNS服务发现系统项目结构

```
kong-discovery/
│
├── cmd/                              # 命令行入口
│   ├── discovery/                    # 主服务程序入口
│   │   └── main.go
│   └── client/                       # 客户端工具入口
│       └── main.go
│
├── pkg/                              # 核心包
│   ├── api/                          # API层
│   │   ├── handler/                  # API处理器
│   │   │   ├── service.go            # 服务相关API处理
│   │   │   ├── health.go             # 健康检查API处理
│   │   │   ├── dns.go                # DNS配置API处理
│   │   │   └── metrics.go            # 监控指标API处理
│   │   ├── middleware/               # 中间件
│   │   │   ├── auth.go               # 认证中间件
│   │   │   ├── logger.go             # 日志中间件
│   │   │   └── metrics.go            # 指标收集中间件
│   │   └── router/                   # 路由配置
│   │       ├── register.go           # 注册服务路由 (8080端口)
│   │       └── admin.go              # 管理服务路由 (9090端口)
│   │
│   ├── config/                       # 配置管理
│   │   ├── config.go                 # 配置结构和加载
│   │   └── default.go                # 默认配置
│   │
│   ├── dns/                          # DNS服务模块
│   │   ├── server.go                 # DNS服务器
│   │   ├── handler.go                # DNS请求处理
│   │   ├── record.go                 # DNS记录管理
│   │   ├── cache.go                  # DNS缓存
│   │   └── upstream.go               # 上游DNS转发
│   │
│   ├── model/                        # 数据模型
│   │   ├── service.go                # 服务实体模型
│   │   ├── dns_record.go             # DNS记录模型
│   │   └── metrics.go                # 监控指标模型
│   │
│   ├── storage/                      # 存储接口
│   │   ├── interface.go              # 存储接口定义
│   │   ├── etcd/                     # ETCD存储实现
│   │   │   ├── client.go             # ETCD客户端
│   │   │   └── service.go            # 服务数据存储
│   │   └── memory/                   # 内存存储实现（用于测试）
│   │       └── service.go            # 内存服务数据存储
│   │
│   ├── service/                      # 业务逻辑层
│   │   ├── register.go               # 服务注册逻辑
│   │   ├── discovery.go              # 服务发现逻辑
│   │   ├── heartbeat.go              # 心跳检测逻辑
│   │   └── health.go                 # 健康检查逻辑
│   │
│   └── util/                         # 工具函数
│       ├── logger.go                 # 日志工具
│       ├── ip.go                     # IP相关工具
│       └── validator.go              # 数据校验工具
│
├── sdk/                              # SDK代码
│   ├── go/                           # Go SDK
│   │   ├── client.go                 # SDK客户端
│   │   ├── register.go               # 服务注册方法
│   │   ├── heartbeat.go              # 心跳维持方法
│   │   └── examples/                 # 示例代码
│   │       └── main.go               # 示例应用
│   └── js/                           # 前端SDK（未来扩展）
│
├── web/                              # 前端代码
│   ├── src/                          # React源代码
│   │   ├── components/               # UI组件
│   │   ├── pages/                    # 页面组件
│   │   ├── services/                 # API服务
│   │   └── App.tsx                   # 应用入口
│   ├── public/                       # 静态资源
│   └── package.json                  # 前端依赖
│
├── deployment/                       # 部署配置
│   ├── docker/                       # Docker相关
│   │   ├── Dockerfile                # 服务Dockerfile
│   │   └── Dockerfile.ui             # UI Dockerfile
│   ├── docker-compose.yml            # Docker Compose配置
│   └── kubernetes/                   # K8s部署配置（未来扩展）
│
├── configs/                          # 配置文件
│   ├── config.yaml                   # 主配置文件
│   └── config.dev.yaml               # 开发环境配置
│
├── scripts/                          # 脚本工具
│   ├── build.sh                      # 构建脚本
│   └── test.sh                       # 测试脚本
│
├── test/                             # 测试
│   ├── integration/                  # 集成测试
│   └── mock/                         # 测试模拟
│
├── docs/                             # 文档
│   ├── api/                          # API文档
│   ├── architecture/                 # 架构文档
│   └── guides/                       # 使用指南
│
├── examples/                         # 示例代码
│   ├── service/                      # 示例服务
│   └── client/                       # 示例客户端
│
├── .github/                          # GitHub配置
│   └── workflows/                    # GitHub Actions
│       ├── build.yml                 # 构建流程
│       └── test.yml                  # 测试流程
│
├── go.mod                            # Go模块定义
├── go.sum                            # Go依赖校验
├── .gitignore                        # Git忽略配置
├── LICENSE                           # 许可证文件
└── README.md                         # 项目说明
```

## 目录说明

### 1. 命令行入口 (cmd/)
- **discovery/**: 主服务程序入口，包含服务启动逻辑
- **client/**: 命令行客户端工具，用于管理和测试

### 2. 核心包 (pkg/)
- **api/**: API相关代码，包括处理器、中间件和路由
  - **handler/**: 各类API请求处理器
  - **middleware/**: 认证、日志等中间件
  - **router/**: 路由配置，分离注册端口(8080)和管理端口(9090)
- **config/**: 配置管理，处理配置文件加载和环境变量
- **dns/**: DNS服务实现，包括53端口服务器和DNS记录管理
- **model/**: 数据模型，定义服务和DNS记录等实体结构
- **storage/**: 存储层接口和实现，主要是etcd存储适配
- **service/**: 业务逻辑层，处理服务注册、发现等核心逻辑
- **util/**: 通用工具函数

### 3. SDK (sdk/)
- **go/**: Go语言SDK实现，供服务实例集成
- **js/**: 前端SDK（预留，未来扩展）

### 4. 前端 (web/)
- React管理界面代码，包括组件、页面和API服务

### 5. 部署 (deployment/)
- Docker、Docker Compose配置
- Kubernetes部署配置（预留）

### 6. 配置 (configs/)
- 配置文件模板和开发环境配置

### 7. 脚本 (scripts/)
- 构建、测试等自动化脚本

### 8. 测试 (test/)
- 集成测试和模拟数据

### 9. 文档 (docs/)
- API文档、架构文档和使用指南

### 10. 示例 (examples/)
- 示例服务和客户端代码

## 文件说明

### 主要配置文件
- **configs/config.yaml**: 主配置文件，包含服务地址、端口、DNS配置等
- **deployment/docker-compose.yml**: Docker部署配置

### 核心服务入口
- **cmd/discovery/main.go**: 服务启动入口

### 关键业务逻辑
- **pkg/service/register.go**: 服务注册逻辑
- **pkg/service/discovery.go**: 服务发现逻辑
- **pkg/dns/server.go**: DNS服务器实现

### API入口
- **pkg/api/router/register.go**: 注册服务API (8080端口)
- **pkg/api/router/admin.go**: 管理服务API (9090端口) 